<script lang="ts">
  import { AbbrevNum } from '$lib/utils'

  import ClipboardIcon from '$components/Icons/Clipboard.svelte'
  import ColumnsIcon from '$components/Icons/Columns.svelte'
  import RowsIcon from '$components/Icons/Rows.svelte'

  import Collapse from './Collapse.svelte'

  // subset of a dataset object needed to initialize this component
  interface Dataset {
    ID: number
    Name: string
    Graphics: string | null
    slug: string | null

    Abstract: string
    Task: string | null
    NumInstances: number
    NumAttributes: number | null
  }

  export let dataset: Dataset

  let collapseOpen = false

  const toggleCollapse = () => {
    collapseOpen = !collapseOpen
  }

  // image src for the dataset avatar
  $: src =
    dataset?.Graphics != null
      ? '/ml/datasets/' + dataset.ID + '/Graphics/SmallLarge.jpg'
      : '/ml/datasets/default/SmallLarge.jpg'
</script>

<div class="hover:bg-base-200 p-2 rounded-lg" on:click={toggleCollapse}>
  <div class="flex flex-col">
    <h1 class="text-primary text-center font-bold break-word underline">
      <a href="/dataset/{dataset.slug}" class="btn btn-ghost">
        {dataset.Name}
      </a>
    </h1>

    <!-- two avatars are actually on the screen; they are hidden/visible at different media queries -->

    <!-- Avatar that will appear under the title when screen is small -->
    <!-- in a flex container with the name to account for long names/overflowing -->
    <div class="sm:hidden avatar col-span-1 w-full my-2 self-center justify-center">
      <div class="mask mask-squircle w-12 h-12 flex align-center">
        <img {src} alt="dataset-graphic-small-screen" />
      </div>
    </div>
  </div>

  <!-- Avatar that will appear to the left of the row when screen is larger -->
  <div class="grid grid-cols-12">
    <div class="hidden sm:flex avatar col-span-1 self-center justify-self-center">
      <div class="mask mask-squircle w-12 h-12 flex align-center">
        <img {src} alt="dataset-graphic-large-screen" />
      </div>
    </div>

    <!-- abstract and preview icons to the right of the avatar, flex column -->
    <div class="col-span-11 gap-5 ml-4">
      <!-- abstract-->
      <h2 class="my-4 line-clamp-4 break-word overflow-x-hidden">
        {dataset.Abstract}
      </h2>

      <!-- preview icons, each take up equal space in a 12 column grid -->
      <div class="hidden md:grid grid-cols-12 gap-4">
        <div class="col-span-4 flex gap-2">
          <ClipboardIcon />
          {dataset.Task}
        </div>
        <div class="col-span-4 flex gap-2">
          <ColumnsIcon />
          {dataset?.NumInstances
            ? AbbrevNum.format(dataset.NumInstances) + '  Instances'
            : 'N/A'}
          ,
        </div>
        <div class="col-span-4 flex gap-2">
          <RowsIcon />
          {dataset?.NumAttributes
            ? AbbrevNum.format(dataset.NumAttributes) + '  Attributes'
            : 'N/A'}
        </div>
      </div>
    </div>
  </div>
</div>

<Collapse bind:collapseOpen completeClose duration={100}>
  <div class="hover:bg-base-200 p-2 rounded-lg" on:click={toggleCollapse}>
    <div class="flex flex-col">
      <h1 class="text-primary text-center font-bold break-word underline">
        <a href="/dataset/{dataset.slug}" class="btn btn-ghost">
          {dataset.Name}
        </a>
      </h1>

      <!-- two avatars are actually on the screen; they are hidden/visible at different media queries -->

      <!-- Avatar that will appear under the title when screen is small -->
      <!-- in a flex container with the name to account for long names/overflowing -->
      <div class="sm:hidden avatar col-span-1 w-full my-2 self-center justify-center">
        <div class="mask mask-squircle w-12 h-12 flex align-center">
          <img {src} alt="dataset-graphic-small-screen" />
        </div>
      </div>
    </div>

    <!-- Avatar that will appear to the left of the row when screen is larger -->
    <div class="grid grid-cols-12">
      <div class="hidden sm:flex avatar col-span-1 self-center justify-self-center">
        <div class="mask mask-squircle w-12 h-12 flex align-center">
          <img {src} alt="dataset-graphic-large-screen" />
        </div>
      </div>

      <!-- abstract and preview icons to the right of the avatar, flex column -->
      <div class="col-span-11 gap-5 ml-4">
        <!-- abstract-->
        <h2 class="my-4 line-clamp-4 break-word overflow-x-hidden">
          {dataset.Abstract}
        </h2>

        <!-- preview icons, each take up equal space in a 12 column grid -->
        <div class="hidden md:grid grid-cols-12 gap-4">
          <div class="col-span-4 flex gap-2">
            <ClipboardIcon />
            {dataset.Task}
          </div>
          <div class="col-span-4 flex gap-2">
            <ColumnsIcon />
            {dataset?.NumInstances
              ? AbbrevNum.format(dataset.NumInstances) + '  Instances'
              : 'N/A'}
            ,
          </div>
          <div class="col-span-4 flex gap-2">
            <RowsIcon />
            {dataset?.NumAttributes
              ? AbbrevNum.format(dataset.NumAttributes) + '  Attributes'
              : 'N/A'}
          </div>
        </div>
      </div>
    </div>
  </div>
</Collapse>
